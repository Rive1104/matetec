<div class="game-container" *ngIf="player">
  
  <!-- ENCABEZADO -->
  <header class="game-header">
    <div class="header-info">
      <strong>Nivel:</strong> {{ level <= 10 ? level : 10 }} ({{ levelDescription }})
    </div>
    <div class="header-info">
      <strong>Jugador:</strong> {{ player.name }}
    </div>
    <div class="timer" [class.urgent]="timeLeft < 10" *ngIf="gameState !== 'finished'">
      Tiempo: <strong>{{ timeLeft }}s</strong>
    </div>
  </header>

  <!-- TABLERO DE JUEGO (Mientras se juega) -->
  <main class="game-board" *ngIf="gameState !== 'finished'">
    
    <!-- IZQUIERDA: Elementos -->
    <section class="operand-container">
      <h3>Elementos</h3>
      <div class="operands-grid">
        <div *ngFor="let op of operands"
             class="operand"
             [class.dropped]="op.isDropped"
             draggable="true"
             (dragstart)="onDragStart($event, op)">
          {{ op.value }}
        </div>
      </div>
    </section>

    <!-- CENTRO: Zona de OperaciÃ³n -->
    <section class="operator-container" (dragover)="onDragOver($event)">
      
      <!-- Slot 1 -->
      <div class="slot" (drop)="onDrop($event, 0)" [class.filled]="droppedValues[0]">
        {{ droppedValues[0]?.value || '?' }}
      </div>

      <!-- Signo 1 -->
      <div class="operator-sign">{{ currentOperations[0] }}</div>

      <!-- Slot 2 -->
      <div class="slot" (drop)="onDrop($event, 1)" [class.filled]="droppedValues[1]">
        {{ droppedValues[1]?.value || '?' }}
      </div>

      <!-- Elementos extra para niveles 9 y 10 (3 tÃ©rminos) -->
      <ng-container *ngIf="droppedValues.length > 2">
        <!-- Signo 2 -->
        <div class="operator-sign">{{ currentOperations[1] }}</div>

        <!-- Slot 3 -->
        <div class="slot" (drop)="onDrop($event, 2)" [class.filled]="droppedValues[2]">
          {{ droppedValues[2]?.value || '?' }}
        </div>
      </ng-container>

    </section>

    <!-- DERECHA: Resultado -->
    <section class="result-container">
      <h3>Resultado</h3>
      <div class="robot-placeholder">
        ðŸ¤–
      </div>
      <div class="target-result">
        {{ targetResult }}
      </div>
    </section>

  </main>

  <!-- PANTALLA DE RESULTADOS (Al terminar los 10 niveles) -->
  <div class="results-panel" *ngIf="gameState === 'finished'">
    <h1>Â¡Juego Terminado!</h1>
    
    <div class="stats-card">
      <h2>{{ player.name }}</h2>
      <div class="stat-row">
        <span>Niveles Superados:</span>
        <span class="val green">{{ levelsWon }}</span>
      </div>
      <div class="stat-row">
        <span>Niveles Fallidos:</span>
        <span class="val red">{{ levelsLost }}</span>
      </div>
      <div class="stat-row">
        <span>Tiempo Total:</span>
        <span class="val">{{ timeSpentTotal }} seg</span>
      </div>
      
      <div class="final-score">
        <span>PuntuaciÃ³n Final:</span>
        <strong>{{ finalScore }} pts</strong>
      </div>
    </div>

    <div class="actions">
      <a routerLink="/puntuaciones" class="btn-primary">Ver Tabla de Puntuaciones</a>
      <a routerLink="/" class="btn-secondary">Volver al Inicio</a>
    </div>
  </div>

  <!-- OVERLAY MENSAJES DE NIVEL -->
  <div class="game-overlay" *ngIf="gameState === 'win' || gameState === 'lose'">
    <div class="message-box" [class.win]="gameState === 'win'" [class.lose]="gameState === 'lose'">
      <h2>{{ gameMessage }}</h2>
      <p>Pasando al siguiente nivel...</p>
    </div>
  </div>

</div>